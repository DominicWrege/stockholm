#! /bin/sh
set -euf

server=$(cac-get-server-by servername "$1")
hostname=$2

serverstatus=$(echo $server | jq -r .status)
case $serverstatus in
  'Powered On') : ;;
  *)
    echo $0: bad server status: $serverstatus >&2
    exit 2
esac

template=$(echo $server | jq -r .template)
case $template in
  'CentOS-7-64bit') infest-"$template" "$server" "$hostname";;
  *)
    echo $0: bad template: $template >&2
    exit 3
esac
