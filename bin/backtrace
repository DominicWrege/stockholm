#! /bin/sh
set -euf

exec >&2

pid=$$
while :; do
  cd /proc/$pid
  cmdline=$(cat cmdline | tr '\0' ' ' | sed 's/ $//')
  ppid=$(grep PPid status | awk '{print$2}')
  printf '%5d %s\n' $pid "$cmdline"
  if [ $pid = 1 ]; then
    break
  else
    pid=$ppid
  fi
done \
  | sed \
      "$(printf '
          s:\(/bin/sh \)%s/\([^ ]\+\):\e[32m\\2\e[m:g
          s:%s/\([^ ]\+\):\e[32;1m\\1\e[m:g
        ' \
          "$(dirname "$0" | bre-escape | sed 's/:/\\:/g')" \
          "$(dirname "$0" | bre-escape | sed 's/:/\\:/g')" \
      )" \
  | tac

ps='Press ^C to abort: '
while :; do
  printf '\e[K\e[31;1m%s\e[m' "$ps"
  read -r _input
done
